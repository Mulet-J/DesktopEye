<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:screenCapture="clr-namespace:DesktopEye.Common.ViewModels.ScreenCapture"
             xmlns:design="clr-namespace:DesktopEye.Common.ViewModels.ScreenCapture.Design"
             mc:Ignorable="d" d:DesignWidth="1400" d:DesignHeight="800"
             x:Class="DesktopEye.Common.Views.ScreenCapture.ScreenCaptureActionsView"
             x:DataType="screenCapture:ScreenCaptureActionsViewModel">

    <Design.DataContext>
        <design:DesignScreenCaptureActionsViewModel />
    </Design.DataContext>

    <UserControl.Styles>
        <!-- Styles cohérents pour les boutons d'action -->
        <Style Selector="Button.action-button">
            <Setter Property="Padding" Value="12,8" />
            <Setter Property="Background" Value="{DynamicResource SystemControlBackgroundAltHighBrush}" />
            <Setter Property="BorderBrush" Value="{DynamicResource SystemControlForegroundBaseLowBrush}" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="CornerRadius" Value="4" />
            <Setter Property="HorizontalContentAlignment" Value="Center" />
            <Setter Property="VerticalContentAlignment" Value="Center" />
        </Style>

        <!-- Styles pour les onglets -->
        <Style Selector="TabItem">
            <Setter Property="FontWeight" Value="Normal" />
            <Setter Property="Padding" Value="16,8" />
            <Setter Property="Margin" Value="0" />
            <Setter Property="Foreground" Value="{DynamicResource SystemControlForegroundBaseHighBrush}" />
        </Style>

        <Style Selector="TabItem:selected">
            <Setter Property="FontWeight" Value="SemiBold" />
        </Style>
    </UserControl.Styles>

    <Grid>
        <!-- Mise en page principale avec panneaux flexibles -->
        <SplitView IsPaneOpen="True"
                   DisplayMode="Inline"
                   OpenPaneLength="520"
                   PanePlacement="Right"
                   Margin="5">

            <!-- Panneau principal (image) -->
            <Border Background="{DynamicResource SystemControlBackgroundAltHighBrush}"
                    BorderBrush="{DynamicResource SystemControlForegroundBaseLowBrush}"
                    BorderThickness="1"
                    CornerRadius="8"
                    Padding="0"
                    BoxShadow="0 4 16 0 #20000000">

            <!-- Ajout d'un bouton pour relancer l'analyse dans le panneau de l'image -->
            <Grid RowDefinitions="Auto,*">
                <!-- Zone d'image (conserve votre code actuel) -->
                <Border Grid.Row="1" Padding="16">
                    <Grid RowDefinitions="*,Auto">
                        <!-- Image -->
                        <Panel Grid.Row="0">
                            <Image Source="{Binding Bitmap}"
                                   Stretch="Uniform"
                                   HorizontalAlignment="Center"
                                   VerticalAlignment="Center" />

                            <!-- Indicateur de chargement -->
                            <ProgressBar IsVisible="{Binding IsProcessingImage}"
                                         IsIndeterminate="True"
                                         Width="100" Height="10"
                                         HorizontalAlignment="Center"
                                         VerticalAlignment="Center" />
                        </Panel>

                        <!-- Barre d'informations -->
                        <Border Grid.Row="1" 
                                Background="{DynamicResource SystemControlBackgroundChromeLowBrush}"
                                BorderThickness="0,1,0,0"
                                BorderBrush="{DynamicResource SystemControlForegroundBaseLowBrush}"
                                Padding="16,8">
                            <Grid ColumnDefinitions="Auto,*,Auto">
                                <!-- Bouton de relance -->
                                <Button Grid.Column="2"
                                        Command="{Binding RelaunchAnalysisCommand}"
                                        ToolTip.Tip="Relancer l'analyse complète"
                                        Classes="refresh-button">
                                    <StackPanel Orientation="Horizontal" Spacing="8">
                                        <PathIcon Data="M17.65,6.35 C16.2,4.9 14.21,4 12,4 C7.58,4 4.01,7.58 4.01,12 C4.01,16.42 7.58,20 12,20 C15.73,20 18.84,17.45 19.73,14 L17.65,14 C16.83,16.33 14.61,18 12,18 C8.69,18 6,15.31 6,12 C6,8.69 8.69,6 12,6 C13.66,6 15.14,6.69 16.22,7.78 L13,11 L20,11 L20,4 L17.65,6.35 Z"
                                                  Width="18" Height="18" />
                                        <TextBlock Text="Relancer l'analyse" FontWeight="Medium"/>
                                    </StackPanel>
                                </Button>
                            </Grid>
                        </Border>
                    </Grid>
                </Border>
            </Grid>
            </Border>

            <!-- Panneau latéral (résultats) -->
            <SplitView.Pane>
                <Border Background="{DynamicResource SystemControlBackgroundAltHighBrush}"
                        BorderBrush="{DynamicResource SystemControlForegroundBaseLowBrush}"
                        BorderThickness="1"
                        CornerRadius="8"
                        Margin="16,0,0,0"
                        BoxShadow="0 4 16 0 #20000000">

                    <Grid RowDefinitions="Auto,*">
                        <!-- Onglets de navigation -->
                        <TabControl Grid.Row="0" Padding="0" Margin="0">
                            <TabItem Header="Texte extrait" x:Name="TextTab">
                                <Grid RowDefinitions="Auto,*,Auto" Margin="16">
                                    <!-- Info langue détectée -->
                                    <Border Grid.Row="0"
                                            Background="{DynamicResource SystemControlBackgroundChromeLowBrush}"
                                            BorderBrush="{DynamicResource SystemControlForegroundBaseLowBrush}"
                                            BorderThickness="1"
                                            CornerRadius="4"
                                            Padding="12,8"
                                            Margin="0,0,0,16">
                                        <Grid ColumnDefinitions="*,Auto,*">
                                            <!-- Langue détectée -->
                                            <StackPanel Grid.Column="0" Orientation="Horizontal"
                                                        VerticalAlignment="Center">
                                                <TextBlock Text="Détecté: " Opacity="0.7" VerticalAlignment="Center"/>
                                                <ComboBox
                                                    ItemsSource="{Binding AvailableLanguages}"
                                                          SelectedItem="{Binding InferredLanguage}"
                                                          HorizontalAlignment="Stretch"
                                                          Margin="0,0,8,0">
                                                </ComboBox>
                                                <ProgressBar IsIndeterminate="True"
                                                             IsVisible="{Binding IsDetectingLanguage}"
                                                             Width="12" Height="12"
                                                             Margin="8,0,0,0" />
                                            </StackPanel>

                                            <!-- Icône d'échange -->
                                            <Button Grid.Column="1"
                                                    Classes="action-button"
                                                    Padding="8,4"
                                                    Margin="8,0"
                                                    ToolTip.Tip="Échanger les langues">
                                                <PathIcon
                                                    Data="M6,2 L10,6 L6,10 M2,6 L10,6 M10,14 L6,18 L10,22 M14,18 L6,18"
                                                    Width="12" Height="12" />
                                            </Button>

                                            <!-- Langue cible -->
                                            <ComboBox Grid.Column="2"
                                                      ItemsSource="{Binding AvailableLanguages}"
                                                      SelectedItem="{Binding TargetLanguage}"
                                                      HorizontalAlignment="Stretch" />
                                        </Grid>
                                    </Border>

                                    <!-- Zone de texte -->
                                    <Border Grid.Row="1"
                                            Background="{DynamicResource SystemControlBackgroundChromeLowBrush}"
                                            BorderBrush="{DynamicResource SystemControlForegroundBaseLowBrush}"
                                            BorderThickness="1"
                                            CornerRadius="4"
                                            Padding="16">
                                        <Grid>
                                            <!-- Texte extrait -->
                                            <ScrollViewer>
                                                <TextBlock Text="{Binding OcrText.Text, FallbackValue=''}"
                                                           IsVisible="{Binding HasOcrText}"
                                                           TextWrapping="Wrap" />
                                            </ScrollViewer>

                                            <!-- État de chargement OCR -->
                                            <StackPanel IsVisible="{Binding IsExtractingText}"
                                                        HorizontalAlignment="Center" VerticalAlignment="Center">
                                                <ProgressBar IsIndeterminate="True" Width="24" Height="24" />
                                                <TextBlock Text="Extraction du texte..."
                                                           HorizontalAlignment="Center" Margin="0,16,0,0" />
                                            </StackPanel>

                                            <!-- Message initial -->
                                            <StackPanel IsVisible="{Binding ShowInitialMessage}"
                                                        HorizontalAlignment="Center" VerticalAlignment="Center">
                                                <ProgressBar IsIndeterminate="True" Width="24" Height="24" />
                                                <TextBlock Text="Analyse automatique en cours..."
                                                           FontWeight="Medium"
                                                           HorizontalAlignment="Center" Margin="0,16,0,0" />
                                                <TextBlock
                                                    Text="Veuillez patienter pendant que nous analysons votre capture"
                                                    Opacity="0.7"
                                                    HorizontalAlignment="Center" Margin="0,8,0,0" TextWrapping="Wrap" />
                                            </StackPanel>
                                        </Grid>
                                    </Border>

                                    <!-- Actions de texte -->
                                    <StackPanel Grid.Row="2" Orientation="Horizontal"
                                                HorizontalAlignment="Right" Margin="0,16,0,0" Spacing="8">
                                        <Button Classes="action-button"
                                                ToolTip.Tip="Copier le texte">
                                            <StackPanel Orientation="Horizontal" Spacing="8">
                                                <PathIcon Data="M2,2 L2,14 L14,14 L14,2 Z M4,4 L12,4 L12,12 L4,12 Z"
                                                          Width="16" Height="16" />
                                                <TextBlock Text="Copier" />
                                            </StackPanel>
                                        </Button>
                                        <Button Classes="action-button"
                                                ToolTip.Tip="Synthèse vocale">
                                            <StackPanel Orientation="Horizontal" Spacing="8">
                                                <PathIcon
                                                    Data="M2,6 L6,6 L10,2 L10,14 L6,10 L2,10 Z M12,4 L12,12 M14,2 L14,14"
                                                    Width="16" Height="16" />
                                                <TextBlock Text="Écouter" />
                                            </StackPanel>
                                        </Button>
                                    </StackPanel>
                                </Grid>
                            </TabItem>

                            <TabItem Header="Traduction" x:Name="TranslationTab">
                                <Grid RowDefinitions="*,Auto" Margin="16">
                                    <!-- Zone de traduction -->
                                    <Border Grid.Row="0"
                                            Background="{DynamicResource SystemControlBackgroundChromeLowBrush}"
                                            BorderBrush="{DynamicResource SystemControlForegroundBaseLowBrush}"
                                            BorderThickness="1"
                                            CornerRadius="4"
                                            Padding="16">
                                        <Grid>
                                            <!-- Texte traduit -->
                                            <ScrollViewer>
                                                <TextBlock Text="{Binding TranslatedText, FallbackValue=''}"
                                                           IsVisible="{Binding HasTranslatedText}"
                                                           TextWrapping="Wrap" />
                                            </ScrollViewer>

                                            <!-- État de chargement traduction -->
                                            <StackPanel IsVisible="{Binding IsTranslating}"
                                                        HorizontalAlignment="Center" VerticalAlignment="Center">
                                                <ProgressBar IsIndeterminate="True" Width="24" Height="24" />
                                                <TextBlock Text="Traduction en cours..."
                                                           HorizontalAlignment="Center" Margin="0,16,0,0" />
                                            </StackPanel>

                                            <!-- Message d'attente -->
                                            <StackPanel IsVisible="{Binding ShowTranslationWaitMessage}"
                                                        HorizontalAlignment="Center" VerticalAlignment="Center">
                                                <ProgressBar IsIndeterminate="True" Width="24" Height="24" />
                                                <TextBlock Text="En attente de l'extraction du texte..."
                                                           FontWeight="Medium"
                                                           HorizontalAlignment="Center" Margin="0,16,0,0" />
                                                <TextBlock Text="La traduction commencera automatiquement"
                                                           Opacity="0.7"
                                                           HorizontalAlignment="Center" Margin="0,8,0,0" />
                                            </StackPanel>
                                        </Grid>
                                    </Border>

                                    <!-- Actions de traduction -->
                                    <StackPanel Grid.Row="1" Orientation="Horizontal"
                                                HorizontalAlignment="Right" Margin="0,16,0,0" Spacing="8">
                                        <Button Classes="action-button"
                                                ToolTip.Tip="Copier la traduction">
                                            <StackPanel Orientation="Horizontal" Spacing="8">
                                                <PathIcon Data="M2,2 L2,14 L14,14 L14,2 Z M4,4 L12,4 L12,12 L4,12 Z"
                                                          Width="16" Height="16" />
                                                <TextBlock Text="Copier" />
                                            </StackPanel>
                                        </Button>
                                        <Button Classes="action-button"
                                                ToolTip.Tip="Synthèse vocale">
                                            <StackPanel Orientation="Horizontal" Spacing="8">
                                                <PathIcon
                                                    Data="M2,6 L6,6 L10,2 L10,14 L6,10 L2,10 Z M12,4 L12,12 M14,2 L14,14"
                                                    Width="16" Height="16" />
                                                <TextBlock Text="Écouter" />
                                            </StackPanel>
                                        </Button>
                                    </StackPanel>
                                </Grid>
                            </TabItem>
                        </TabControl>
                    </Grid>
                </Border>
            </SplitView.Pane>
        </SplitView>
    </Grid>
</UserControl>