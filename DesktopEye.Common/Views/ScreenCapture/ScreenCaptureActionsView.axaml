<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:screenCapture="clr-namespace:DesktopEye.Common.ViewModels.ScreenCapture"
             xmlns:design="clr-namespace:DesktopEye.Common.ViewModels.ScreenCapture.Design"
             mc:Ignorable="d" d:DesignWidth="1400" d:DesignHeight="800"
             x:Class="DesktopEye.Common.Views.ScreenCapture.ScreenCaptureActionsView"
             x:DataType="screenCapture:ScreenCaptureActionsViewModel">

    <Design.DataContext>
        <design:DesignScreenCaptureActionsViewModel />
    </Design.DataContext>
    
    <Grid>
        <!-- Fond semi-transparent -->
        <Grid.Background>
            <SolidColorBrush Color="#90000000" />
        </Grid.Background>

        <!-- Layout principal -->
        <Grid HorizontalAlignment="Stretch" VerticalAlignment="Stretch" 
              Margin="60">
            
            <!-- Deux colonnes : Image (gauche) et Contexte (droite) -->
            <Grid ColumnDefinitions="1*,40,1*">
                
                <!-- Colonne gauche : Zone d'image -->
                <Border Grid.Column="0"
                        HorizontalAlignment="Stretch" VerticalAlignment="Stretch"
                        Background="{DynamicResource SystemControlBackgroundAltHighBrush}"
                        BorderBrush="{DynamicResource SystemControlForegroundBaseLowBrush}"
                        BorderThickness="1"
                        CornerRadius="4">
                    
                    <Grid RowDefinitions="Auto,*">
                        
                        <!-- En-tête image -->
                        <Border Grid.Row="0" 
                                Background="{DynamicResource SystemControlBackgroundChromeMediumBrush}" 
                                BorderBrush="{DynamicResource SystemControlForegroundBaseLowBrush}"
                                BorderThickness="0,0,0,1" 
                                Padding="10">
                            <TextBlock Text="Capture d'écran" 
                                       FontWeight="SemiBold"
                                       Foreground="{DynamicResource SystemControlForegroundBaseHighBrush}" />
                        </Border>
                        
                        <!-- Zone d'image -->
                        <Border Grid.Row="1" Margin="10">
                            <Image Source="{Binding Bitmap}" 
                                   Stretch="Uniform"
                                   HorizontalAlignment="Center"
                                   VerticalAlignment="Center" />
                        </Border>
                    </Grid>
                </Border>
                
                <!-- Colonne droite : Zone contextuelle -->
                <Border Grid.Column="2"
                        HorizontalAlignment="Stretch" VerticalAlignment="Stretch"
                        Background="{DynamicResource SystemControlBackgroundAltHighBrush}"
                        BorderBrush="{DynamicResource SystemControlForegroundBaseLowBrush}"
                        BorderThickness="1"
                        CornerRadius="4">
                    
                    <Grid RowDefinitions="Auto,*">
                        
                        <!-- En-tête avec onglets de résultats -->
                        <Border Grid.Row="0" 
                                Background="{DynamicResource SystemControlBackgroundChromeMediumBrush}"
                                BorderBrush="{DynamicResource SystemControlForegroundBaseLowBrush}"
                                BorderThickness="0,0,0,1">
                            <Grid>
                                <Grid RowDefinitions="Auto,Auto">
                                    
                                    <!-- Barre d'onglets -->
                                    <TabStrip Grid.Row="0" Margin="0">
                                        <TabStripItem x:Name="TextTabButton" IsSelected="True" Tapped="OnTextTabClick">
                                            <TextBlock Text="Texte extrait" />
                                        </TabStripItem>
                                        <TabStripItem x:Name="TranslationTabButton" Tapped="OnTranslationTabClick">
                                            <TextBlock Text="Traduction" />
                                        </TabStripItem>
                                    </TabStrip>
                                    
                                    <!-- Sélecteur de langue -->
                                    <Grid Grid.Row="1" ColumnDefinitions="*,Auto,*" Margin="10">
                                        
                                        <!-- Langue détectée -->
                                        <StackPanel Grid.Column="0" Orientation="Horizontal" 
                                                    VerticalAlignment="Center">
                                            <TextBlock Text="{Binding InferredLanguage, FallbackValue='Détection...'}" />
                                            <ProgressBar IsIndeterminate="True" Width="16" Height="16"
                                                         IsVisible="{Binding IsDetectingLanguage}" 
                                                         Margin="8,0,0,0" />
                                        </StackPanel>
                                        
                                        <!-- Bouton d'échange -->
                                        <Button Grid.Column="1" Padding="8,4">
                                            <PathIcon Data="M6,2 L10,6 L6,10 M2,6 L10,6 M10,14 L6,18 L10,22 M14,18 L6,18" />
                                        </Button>
                                        
                                        <!-- Langue cible -->
                                        <ComboBox Grid.Column="2"
                                                  ItemsSource="{Binding AvailableLanguages}"
                                                  SelectedItem="{Binding TargetLanguage}"
                                                  HorizontalAlignment="Right" />
                                    </Grid>
                                </Grid>
                            </Grid>
                        </Border>
                        
                        <!-- Zone de contenu avec onglets -->
                        <Grid Grid.Row="1">
                            
                            <!-- Onglet Texte extrait -->
                            <Grid x:Name="TextTabContent" Margin="10">
                                <Grid RowDefinitions="*,Auto">
                                    
                                    <!-- Zone de texte -->
                                    <Border Grid.Row="0" 
                                            Background="{DynamicResource SystemControlBackgroundChromeLowBrush}"
                                            BorderBrush="{DynamicResource SystemControlForegroundBaseLowBrush}"
                                            BorderThickness="1" 
                                            CornerRadius="2"
                                            Padding="10">
                                        <Grid>
                                            <!-- Texte extrait -->
                                            <ScrollViewer>
                                                <TextBlock Text="{Binding OcrText, FallbackValue=''}"
                                                           IsVisible="{Binding HasOcrText}"
                                                           TextWrapping="Wrap" />
                                            </ScrollViewer>
                                            
                                            <!-- État de chargement OCR -->
                                            <StackPanel IsVisible="{Binding IsExtractingText}" 
                                                        HorizontalAlignment="Center" VerticalAlignment="Center">
                                                <ProgressBar IsIndeterminate="True" Width="100" Height="4" />
                                                <TextBlock Text="Extraction du texte..." 
                                                           HorizontalAlignment="Center" Margin="0,10,0,0" />
                                            </StackPanel>
                                            
                                            <!-- Message initial -->
                                            <StackPanel IsVisible="{Binding ShowInitialMessage}" 
                                                        HorizontalAlignment="Center" VerticalAlignment="Center">
                                                <ProgressBar IsIndeterminate="True" Width="100" Height="4" />
                                                <TextBlock Text="Analyse automatique en cours..." 
                                                           HorizontalAlignment="Center" Margin="0,10,0,0" />
                                                <TextBlock Text="Veuillez patienter pendant que nous analysons votre capture" 
                                                           Opacity="0.7" 
                                                           HorizontalAlignment="Center" Margin="0,8,0,0" TextWrapping="Wrap" />
                                            </StackPanel>
                                        </Grid>
                                    </Border>
                                    
                                    <!-- Actions de texte -->
                                    <StackPanel Grid.Row="1" Orientation="Horizontal" 
                                                HorizontalAlignment="Right" Margin="0,10,0,0" Spacing="8">
                                        <Button ToolTip.Tip="Copier le texte">
                                            <StackPanel Orientation="Horizontal" Spacing="8">
                                                <PathIcon Data="M2,2 L2,14 L14,14 L14,2 Z M4,4 L12,4 L12,12 L4,12 Z" />
                                                <TextBlock Text="Copier" />
                                            </StackPanel>
                                        </Button>
                                        <Button ToolTip.Tip="Synthèse vocale">
                                            <StackPanel Orientation="Horizontal" Spacing="8">
                                                <PathIcon Data="M2,6 L6,6 L10,2 L10,14 L6,10 L2,10 Z M12,4 L12,12 M14,2 L14,14" />
                                                <TextBlock Text="Écouter" />
                                            </StackPanel>
                                        </Button>
                                    </StackPanel>
                                </Grid>
                            </Grid>
                            
                            <!-- Onglet Traduction -->
                            <Grid x:Name="TranslationTabContent" Margin="10" IsVisible="False">
                                <Grid RowDefinitions="*,Auto">
                                    
                                    <!-- Zone de traduction -->
                                    <Border Grid.Row="0"
                                            Background="{DynamicResource SystemControlBackgroundChromeLowBrush}"
                                            BorderBrush="{DynamicResource SystemControlForegroundBaseLowBrush}"
                                            BorderThickness="1" 
                                            CornerRadius="2"
                                            Padding="10">
                                        <Grid>
                                            <!-- Texte traduit -->
                                            <ScrollViewer>
                                                <TextBlock Text="{Binding TranslatedText, FallbackValue=''}"
                                                           IsVisible="{Binding HasTranslatedText}"
                                                           TextWrapping="Wrap" />
                                            </ScrollViewer>
                                            
                                            <!-- État de chargement traduction -->
                                            <StackPanel IsVisible="{Binding IsTranslating}" 
                                                        HorizontalAlignment="Center" VerticalAlignment="Center">
                                                <ProgressBar IsIndeterminate="True" Width="100" Height="4" />
                                                <TextBlock Text="Traduction en cours..." 
                                                           HorizontalAlignment="Center" Margin="0,10,0,0" />
                                            </StackPanel>
                                            
                                            <!-- Message d'attente -->
                                            <StackPanel IsVisible="{Binding ShowTranslationWaitMessage}" 
                                                        HorizontalAlignment="Center" VerticalAlignment="Center">
                                                <ProgressBar IsIndeterminate="True" Width="100" Height="4" />
                                                <TextBlock Text="En attente de l'extraction du texte..." 
                                                           HorizontalAlignment="Center" Margin="0,10,0,0" />
                                                <TextBlock Text="La traduction commencera automatiquement" 
                                                           Opacity="0.7" 
                                                           HorizontalAlignment="Center" Margin="0,8,0,0" />
                                            </StackPanel>
                                        </Grid>
                                    </Border>
                                    
                                    <!-- Actions de traduction -->
                                    <StackPanel Grid.Row="1" Orientation="Horizontal" 
                                                HorizontalAlignment="Right" Margin="0,10,0,0" Spacing="8">
                                        <Button ToolTip.Tip="Copier la traduction">
                                            <StackPanel Orientation="Horizontal" Spacing="8">
                                                <PathIcon Data="M2,2 L2,14 L14,14 L14,2 Z M4,4 L12,4 L12,12 L4,12 Z" />
                                                <TextBlock Text="Copier" />
                                            </StackPanel>
                                        </Button>
                                        <Button ToolTip.Tip="Synthèse vocale">
                                            <StackPanel Orientation="Horizontal" Spacing="8">
                                                <PathIcon Data="M2,6 L6,6 L10,2 L10,14 L6,10 L2,10 Z M12,4 L12,12 M14,2 L14,14" />
                                                <TextBlock Text="Écouter" />
                                            </StackPanel>
                                        </Button>
                                    </StackPanel>
                                </Grid>
                            </Grid>
                        </Grid>
                    </Grid>
                </Border>
            </Grid>
        </Grid>

        <!-- Bouton fermer -->
        <Button HorizontalAlignment="Right" 
                VerticalAlignment="Top" 
                Margin="20"
                Click="OnCloseClick">
            <PathIcon Data="M8,8 L16,16 M8,16 L16,8" />
        </Button>
    </Grid>
</UserControl>